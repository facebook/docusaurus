---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

ä½¿ç”¨ [Workbox](https://developers.google.com/web/tools/workbox) æ¥æ·»åŠ  PWA æ”¯æŒçš„ Docusaurus æ’ä»¶ã€‚ æ­¤æ’ä»¶å°†ä»…åœ¨ç”Ÿäº§æ„å»ºä¸­ç”Ÿæˆ [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œè®©ä½ åˆ›å»ºæ”¯æŒç¦»çº¿æ¨¡å¼å’Œåº”ç”¨å®‰è£…çš„ PWA æ–‡æ¡£ç«™ç‚¹ã€‚

## å®‰è£…æµç¨‹ {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨ `./static/manifest.json` å¤„æ–°å»º [PWA Manifest](https://web.dev/add-manifest/)ã€‚

åœ¨ `docusaurus.config.js` é‡Œç®€å•é…ç½® PWAï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¸è¿›å¼ç½‘é¡µåº”ç”¨ {#progressive-web-app}

å®‰è£… Service Worker è¿˜ä¸è¶³ä»¥è®©ä½ çš„åº”ç”¨æˆä¸ºæ¸è¿›å¼ Web åº”ç”¨ (PWA)ã€‚ ä½ è‡³å°‘éœ€è¦å…ˆæ·»åŠ ä¸€ä¸ª [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)ï¼Œå¹¶åœ¨ `<head>` é‡Œå¡«å†™æ­£ç¡®çš„æ ‡ç­¾ï¼ˆ[é€‰é¡¹ > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²åï¼Œä½ å¯ä»¥ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) æ¥æ£€æŸ¥ç½‘ç«™çš„æ€§èƒ½ã€‚

[PWA æ£€æŸ¥å•](https://developers.google.com/web/progressive-web-apps/checklist)è¯¦å°½åœ°åˆ—å‡ºäº†ä¸€ä¸ªç½‘ç«™è¦æˆä¸º PWA çš„æ¡ä»¶ã€‚

## åº”ç”¨å®‰è£…æ”¯æŒ {#app-installation-support}

å¦‚æœä½ çš„æµè§ˆå™¨æ”¯æŒï¼Œå°±å¯ä»¥æŠŠ Docusaurus å½“ä½œåº”ç”¨å®‰è£…äº†ã€‚

![å®‰è£…è¿‡ç¨‹çš„å½•å±ã€‚ æµè§ˆå™¨çš„åœ°å€æ ä¸­ä¼šå‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰ä¸‹åå±•ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®ã€Œæ˜¯å¦å®‰è£…è¿™ä¸ªåº”ç”¨ï¼Ÿã€ ç‚¹å‡»ã€Œå®‰è£…ã€æŒ‰é’®åï¼Œæ“ä½œç³»ç»Ÿä¸­ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„åº”ç”¨ï¼Œæ˜¾ç¤º Docusaurus çš„ä¸»é¡µã€‚](/img/pwa_install.gif)

:::note

å®‰è£…åº”ç”¨éœ€è¦ HTTPS åè®®åŠæœ‰æ•ˆçš„ Manifestã€‚

:::

## ç¦»çº¿æ¨¡å¼ï¼ˆé¢„ç¼“å­˜ï¼‰ {#offline-mode-precaching}

æˆ‘ä»¬é€šè¿‡ Service Worker é¢„ç¼“å­˜çš„æ–¹å¼æ”¯æŒç”¨æˆ·ç¦»çº¿è®¿é—® Docusaurus ç«™ç‚¹ã€‚

The [workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) page explains the idea:

> Service Worker çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯åœ¨å®‰è£…è¿‡ç¨‹ä¸­æŠŠä¸€äº›æ–‡ä»¶ä¿å­˜åˆ°ç¼“å­˜ã€‚ å› ä¸ºä½ åœ¨ Service Worker å·¥ä½œä¹‹å‰å°±å¼€å§‹ç¼“å­˜å†…å®¹äº†ï¼Œæ‰€ä»¥è¿™ä¸€èˆ¬è¢«ç§°ä¸ºã€Œé¢„ç¼“å­˜ã€ã€‚
> 
> ä½¿ç”¨æ­¤åŠŸèƒ½çš„ä¸»è¦åŸå› æ˜¯è®©å¼€å‘è€…æ§åˆ¶ç¼“å­˜ï¼Œå³å†³å®šä½•æ—¶ç¼“å­˜ã€ç¼“å­˜å¤šé•¿æ—¶é—´ã€ä»¥åŠåœ¨ç¦»çº¿æ—¶å‘æµè§ˆå™¨æä¾›å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºç¦»çº¿ç½‘é¡µåº”ç”¨ã€‚
> 
> Workbox ä¸ºä½ å®Œæˆäº†é¢„ç¼“å­˜æœŸé—´çš„è¯¸å¤šå¤æ‚å·¥ä½œï¼Œç®€åŒ–äº† API çš„åŒæ—¶è¿˜ç¡®ä¿èƒ½é«˜æ•ˆç‡åœ°ä¸‹è½½èµ„æºã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç½‘ç«™ä½œä¸ºåº”ç”¨ç¨‹åºå®‰è£…æ—¶ï¼Œå°†é»˜è®¤å¯ç”¨ç¦»çº¿æ¨¡å¼ã€‚ è¯·å‚é˜… `offlineModeActivationStrategies` é€‰é¡¹ä»¥äº†è§£è¯¦æƒ…ã€‚

ç½‘ç«™é¢„ç¼“å­˜å®Œæ¯•åï¼ŒService Worker å°†ä¸ºä¹‹åçš„è¯·æ±‚æä¾›ç¼“å­˜å¥½çš„å“åº”ã€‚ å½“æ–°æ„å»ºçš„ç‰ˆæœ¬éšç€æ–°çš„ Service Worker ä¸€èµ·éƒ¨ç½²åï¼Œæ–°ç‰ˆæœ¬ä¼šè‡ªåŠ¨å¼€å§‹å®‰è£…å¹¶å˜æˆç­‰å¾…çŠ¶æ€ã€‚ åœ¨æ­¤æœŸé—´ï¼Œç½‘ç«™ä¼šå¼¹å‡ºåˆ·æ–°å¼¹çª—ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ–°å†…å®¹ã€‚ é™¤éç”¨æˆ·æ¸…é™¤åº”ç”¨ç¨‹åºç¼“å­˜ï¼Œæˆ–è€…ç‚¹å‡»å¼¹çª—çš„ `åˆ·æ–°` æŒ‰é’®ï¼Œå¦åˆ™ Service Worker å°†ä¸€ç›´æä¾›æ—§å†…å®¹ã€‚

:::warning

ç¦»çº¿æ¨¡å¼/é¢„ç¼“å­˜éœ€è¦æå‰ä¸‹è½½ç½‘ç«™ä¸Šçš„æ‰€æœ‰é™æ€èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æµé‡æ¶ˆè€—ã€‚ å¹¶éæ¯ä¸ªç«™ç‚¹éƒ½æœ‰å¿…è¦å¼€å¯æ­¤é€‰é¡¹ã€‚

:::

## é€‰é¡¹ {#options}

### `debug` {#debug}

- ç±»å‹ï¼š`boolean`
- é»˜è®¤å€¼ï¼š`false`

æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

- Workbox æ—¥å¿—
- é¢å¤–çš„ Docusaurus æ—¥å¿—
- æœªä¼˜åŒ–çš„ SW æ–‡ä»¶è¾“å‡º
- Source Map

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- ç±»å‹ï¼š`('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é»˜è®¤å€¼ï¼š`['appInstalled', 'queryString', 'standalone']`

å¼€å¯ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥æœ‰ï¼š

- `appInstalled`ï¼šåœ¨ç”¨æˆ·å®‰è£…ç½‘ç«™ä¸ºåº”ç”¨ç¨‹åºæ—¶å¯ç”¨ï¼ˆå¹¶éç™¾åˆ†ç™¾å¯é ï¼‰
- `standalone`ï¼šåœ¨ç”¨æˆ·ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œåº”ç”¨ç¨‹åºæ—¶å¯ç”¨ï¼ˆé€šå¸¸æ˜¯ç´§éšå®‰è£… PWA ä¹‹åï¼‰
- `queryString`ï¼šåœ¨ queryString åŒ…å« `offlineMode=true` æ—¶å¯ç”¨ï¼ˆé€šå¸¸ç”¨äº PWA è°ƒè¯•ï¼‰
- `mobile`ï¼šä¸ºæ‰‹æœºç”¨æˆ·å¯ç”¨ï¼ˆ`å®½åº¦ <= 996px`ï¼‰
- `saveData`ï¼šä¸º `navigator.connection.saveData === true` çš„ç”¨æˆ·å¯ç”¨
- `always`ï¼šä¸ºæ‰€æœ‰ç”¨æˆ·å¯ç”¨

:::warning

ç”¨è¿™ä¸ªåŠŸèƒ½è¦å°å¿ƒï¼šæŸäº›ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢å¼ºåˆ¶ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

It is not possible to detect if a page is rendered as a PWA in a reliable manner.

[æŠ€æœ¯è§„èŒƒ](https://github.com/w3c/manifest/pull/836)ä¸­å·²ç»ç§»é™¤äº† `appinstalled` äº‹ä»¶ï¼Œè€Œä¸”åªæœ‰æ–°ç‰ˆæœ¬çš„ Chrome æ”¯æŒ [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) APIï¼Œæ­¤æ—¶è¿˜éœ€è¦åœ¨ Manifest ä¸­å£°æ˜ `related_applications`ã€‚

[`standalone` ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯å¯ç”¨ç¦»çº¿æ¨¡å¼çš„ä¸é”™çš„å¤‡é€‰æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨è¿è¡Œå·²å®‰è£…åº”ç”¨æ—¶ï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

ä¼ é€’ç»™ `workbox.injectManifest()` çš„ [Workbox é€‰é¡¹](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ã€‚ è¿™ä¸ªé€‰é¡¹å…è®¸ä½ ç­›é€‰éœ€è¦é¢„ç¼“å­˜ï¼Œä¸”å¯ç¦»çº¿æµè§ˆçš„èµ„æºã€‚

- ç±»å‹ï¼š`InjectManifestOptions`
- é»˜è®¤å€¼ï¼š`{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // æˆ‘ä»¬å·²ç»åŒ…æ‹¬äº†å¸¸è§çš„é™æ€èµ„æºï¼ˆHTMLã€å›¾åƒç­‰ï¼‰
          // ä½ å¯ä»¥åœ¨æ­¤å¤„æŒ‰éœ€æ·»åŠ æ–‡ä»¶
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- ç±»å‹ï¼š`({ tagName: string; [attributeName: string]: string })[]`
- é»˜è®¤å€¼ï¼š`[]`

ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«äº† `tagName` å’Œå±æ€§é”®å€¼å¯¹ï¼Œä¼šè¢«æ³¨å…¥ `<head>` æ ‡ç­¾ã€‚ ç†è®ºä¸Šè¯´ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹æ³¨å…¥ä»»ä½• head æ ‡ç­¾ï¼Œä½†æœ€å¥½æ³¨å…¥é‚£äº›èƒ½è®©ä½ çš„ç½‘ç«™å…¼å®¹ PWA çš„æ ‡ç­¾ã€‚ ä¸‹é¢åˆ—å‡ºäº†èƒ½è®©ä½ çš„åº”ç”¨ç¨‹åºå®Œå…¨å…¼å®¹ PWA çš„æ ‡ç­¾ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- ç±»å‹ï¼š`string | undefined`
- é»˜è®¤å€¼ï¼š`undefined`

é€‚ç”¨äºé¢å¤–çš„ Workbox è§„åˆ™ã€‚ ä½ å¯ä»¥åœ¨æ­¤å¤„ç¼–å†™ä»»ä½•æƒ³è®© Service Worker åšçš„äº‹ï¼Œè®© Workbox ç‰©å°½å…¶ç”¨ã€‚ ä»£ç ä¼šè¢«è‡ªåŠ¨è½¬è¯‘ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™é‡Œç”¨æœ€æ–°çš„ ES6+ è¯­æ³•ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬è¦ä»å¤–éƒ¨è·¯å¾„ç¼“å­˜æ–‡ä»¶ï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// å¯¼å‡ºæ¥æ”¶æœ‰ç”¨å‚æ•°çš„é»˜è®¤å‡½æ•°
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // ä»å¤–éƒ¨èµ„æºç¼“å­˜å“åº”
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

è¿™ä¸ªæ¨¡å—åº” `default` å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¼šæ¥å—ä¸€ä¸ªå¯¹è±¡å‚æ•°ã€‚

### `swRegister` {#swregister}

- ç±»å‹ï¼š`string | false`
- é»˜è®¤å€¼ï¼š`'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus åº”ç”¨å‰æ·»åŠ å…¥å£ï¼Œåœ¨åº”ç”¨è¿è¡Œå‰è§¦å‘æ³¨å†Œã€‚ é»˜è®¤çš„ `registerSW.js` æ–‡ä»¶è¶³å¤Ÿè¿›è¡Œç®€å•æ³¨å†Œäº†ã€‚

è®¾ç½®ä¸º `false` ä¼šå®Œå…¨å…³é—­æ³¨å†ŒåŠŸèƒ½ã€‚

## Manifest ç¤ºä¾‹ {#manifest-example}

Docusaurus ç½‘ç«™çš„ Manifest å¯ä»¥ç»™ä½ ä¸€äº›å¯å‘ï¼š

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## ä¸ªæ€§åŒ–åˆ·æ–°æç¤ºæ¡† {#customizing-reload-popup}

åœ¨æ–°çš„ Service Worker ç­‰å¾…å®‰è£…ï¼Œæˆ‘ä»¬å‘ç”¨æˆ·æç¤ºåˆ·æ–°çš„æ—¶å€™ï¼Œä¼šæ¸²æŸ“ `@theme/PwaReloadPopup` ç»„ä»¶ã€‚ ä½ å¯ä»¥ [swizzle](../../swizzling.mdx) è¿™ä¸ªç»„ä»¶ï¼Œç„¶åå®ç°ä½ è‡ªå·±çš„ UIã€‚ å®ƒä¼šæ¥å—ä¸€ä¸ª `onReload` å›è°ƒä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå›è°ƒåº”è¯¥åœ¨ `åˆ·æ–°` æŒ‰é’®è¢«ç‚¹å‡»åè°ƒç”¨ã€‚ è¿™ä¼šå‘Šè¯‰ Service Worker å®‰è£…ç­‰å¾…ä¸­çš„æ–°ç‰ˆ Service Workerï¼Œå¹¶åˆ·æ–°é¡µé¢ã€‚

é»˜è®¤ä¸»é¢˜åŒ…å«äº†ä¸€ä¸ªåˆ·æ–°å¼¹çª—çš„é»˜è®¤å®ç°ï¼Œä½¿ç”¨äº† [Infima Alerts](https://infima.dev/docs/components/alert)ã€‚

![åˆ·æ–°è¿‡ç¨‹çš„å½•å±ã€‚ çª—å£å³ä¸‹æ–¹ä¼šæ˜¾ç¤ºä¸€ä¸ªæç¤ºæ¡†ï¼Œè¡¨ç¤ºã€Œæœ‰æ–°å†…å®¹å¯ç”¨ã€ã€‚ ç‚¹å‡»ã€Œåˆ·æ–°ã€æŒ‰é’®åï¼Œé¡µé¢çš„ä¸»æ ‡é¢˜ä» "Introduction" å˜æˆäº† "PWA :))"ã€‚](/img/pwa_reload.gif)

ä½ çš„ç»„ä»¶ä¹Ÿå¯ä»¥è¿”å› `null`ï¼Œä½†æˆ‘ä»¬ä¸æ¨èè¿™ä¹ˆåšï¼šè¿™æ ·ç”¨æˆ·å°±æ²¡åŠæ³•è·å–æœ€æ–°å†…å®¹äº†ã€‚
