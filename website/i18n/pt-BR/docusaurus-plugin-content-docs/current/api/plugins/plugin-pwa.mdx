---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# üì¶ plugin-pwa

Plugin Docusaurus para adicionar suporte √† PWA usando [Workbox](https://developers. google. com/web/tools/workbox). Este plugin gera um [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers) somente na compila√ß√£o de produ√ß√£o, e permite que voc√™ crie um site de documenta√ß√£o compat√≠vel com PWA, com suporte offline e instala√ß√£o.

## Instala√ß√£o {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## Configura√ß√£o {#configuration}

Crie um [manifesto PWA](https://web.dev/add-manifest/) em `./static/manifest.json`.

Modifique `docusaurus.config.js` com uma configura√ß√£o PWA m√≠nima, como:

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## App Web Progressivo {#progressive-web-app}

Ter um worker de servi√ßo instalado n√£o √© suficiente para fazer da sua aplica√ß√£o um PWA. Voc√™ precisa incluir pelo menos um [manifesto do Web App](https://developer.mozilla.org/en-US/docs/Web/Manifest) e ter as tags corretas em `<head>` ([Op√ß√µes > pwaHead](#pwahead)).

Ap√≥s a implanta√ß√£o, voc√™ pode usar [Farol](https://developers.google.com/web/tools/lighthouse) para executar uma auditoria no seu site.

Para uma lista mais exaustiva do que √© preciso para o seu site ser um PWA, consulte a [Checklist PWA](https://developers.google.com/web/progressive-web-apps/checklist)

## Suporte para instala√ß√£o do aplicativo {#app-installation-support}

Se seu navegador suporta isso, voc√™ deve ser capaz de instalar um site do Docusaurus como um aplicativo.

![A screen recording of the installation process. A button appears in the address bar of the browser, which displays a dialog asking "install this application?" when clicked. After clicking the "Install" button, a new application is opened in the operating system, opening to the Docusaurus homepage.](/img/pwa_install.gif)

:::note

App installation requires the HTTPS protocol and a valid manifest.

:::

## Modo off-line (sobreposi√ß√£o) {#offline-mode-precaching}

Permite que os usu√°rios navegue em um site do Docusaurus off-line, usando a predefini√ß√£o do colaborador do servi√ßo.

The [workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) page explains the idea:

> Uma das caracter√≠sticas dos workers do servi√ßo √© a capacidade de salvar um conjunto de arquivos no cache quando o trabalhador do servi√ßo estiver instalando. Isso √© frequentemente referido como "precurso", j√° que voc√™ est√° fazendo cache de conte√∫do √† frente do trabalhador do servi√ßo sendo usado.
> 
> A principal raz√£o para fazer isso √© que ele d√° aos desenvolvedores controle sobre o cache, significando que eles podem determinar quando e por quanto tempo um arquivo √© armazenado em cache e tamb√©m servi-lo para o navegador sem ir para a rede, o que significa que pode ser usado para criar aplicativos web que trabalham offline.
> 
> Caixa de trabalho leva muito do trabalho para fora do processo de perfura√ß√£o, simplificando a API e garantindo que os ativos sejam baixados eficientemente.

Por padr√£o, o modo offline √© ativado quando o site √© instalado como um aplicativo. Consulte a op√ß√£o `offlineModeActivationStrategies` para obter detalhes.

Depois que o site for precedido, o trabalhador do servi√ßo ir√° servir respostas em cache para visitas posteriores. Quando uma nova compila√ß√£o √© implantada junto com um novo funcion√°rio, o novo vai come√ßar a instalar e eventualmente passar para um estado de espera. Durante este estado de espera, um pop-up de recarga ser√° exibido e pedir√° ao usu√°rio para recarregar a p√°gina para um novo conte√∫do. At√© que o usu√°rio limpe o cache do aplicativo ou clica no bot√£o de recarregar `` no popup, o trabalhador dos servi√ßos continuar√° a servir o conte√∫do antigo.

:::warning

Modo Offline / precaching requer baixar todos os recursos est√°ticos do site antes do tempo, e pode consumir largura de banda desnecess√°ria. Poder√° n√£o ser uma boa ideia activ√°-la para todo o tipo de sites.

:::

## Op√ß√µes {#options}

### `debug` {#debug}

- Tipo: `boolean`
- Padr√£o: `false`

Ativar modo depura√ß√£o:

- Registros de workbox
- Logs adicionais do Docusaurus
- Sa√≠da de arquivo SW n√£o otimizada
- Mapas de origem

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- Type: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- Default: `['appInstalled', 'queryString', 'standalone']`

Estrat√©gias usadas para ativar o modo offline em:

- `appInstalled`: ativa para usu√°rios que instalaram o site como um aplicativo (n√£o 100% confi√°vel)
- `standalone`: ativa para usu√°rios que executam o aplicativo como standalone (muitas vezes o caso, uma vez que um PWA √© instalado)
- `queryString`: ativa se queryString cont√©m `offlineMode=true` (conveniente para depura√ß√£o de PWA)
- `mobile`: activates for mobile users (`width <= 996px`)
- `saveData`: ativa para usu√°rios com `navigator.connection.saveData === true`
- `always`: ativa para todos os usu√°rios

:::warning

Use com cuidado: alguns usu√°rios podem n√£o gostar de ser for√ßados a usar o modo offline.

:::

:::danger

It is not possible to detect if a page is rendered as a PWA in a reliable manner.

O evento `appinstalled` foi [removido da especifica√ß√£o](https://github.com/w3c/manifest/pull/836) e o [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API s√≥ √© compat√≠vel com as vers√µes recentes do Chrome e requer `related_applications` declarado no manifesto.

A [estrat√©gia `standalone`](https://petelepage.com/blog/2019/07/is-my-pwa-installed/) √© um bom substituto para ativar a modo offline (pelo menos ao executar o aplicativo instalado).

:::

### `injectManifestConfig` {#injectmanifestconfig}

[Workbox options](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions) to pass to `workbox.injectManifest()`. Ele fornece controle sobre quais arquivos ser√£o precedidos e dispon√≠veis offline.

- Tipo: `InjectManifestOptions`
- Padr√£o: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- Type: `({ tagName: string; [attributeName: string]: string })[]`
- Padr√£o: `[]`

Array de objetos contendo `tagName` e pares chave-valor para atributos injetar na tag `<head>`. Tecnicamente, voc√™ pode injetar qualquer tag head atrav√©s disto, mas √© idealmente usado para tags para tornar o PWA compat√≠vel com seu site. Aqui est√° uma lista de tags para tornar seu aplicativo totalmente compat√≠vel:

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- Tipo: `string | undefined`
- Padr√£o: `undefined`

√ötil para regras adicionais da caixa de trabalho. Voc√™ pode fazer tudo o que um service worker pode fazer aqui e usar todo o poder das bibliotecas da caixa de trabalho. O c√≥digo foi transpilado, ent√£o voc√™ pode usar a sintaxe moderna ES6+ aqui.

Por exemplo, para armazenar em cache arquivos de rotas externas:

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

O m√≥dulo deve ter um `default` de exporta√ß√£o de fun√ß√£o, e receber alguns par√¢metros.

### `swRegister` {#swregister}

- Tipo: `string | false`
- Padr√£o: `'docusaurus-plugin-pwa/src/registerSW.js'`

Adiciona uma entrada antes do aplicativo Docusaurus para que o registro possa acontecer antes que o aplicativo seja executado. O arquivo padr√£o `registerSW.js` √© suficiente para um simples registro.

Passar `false` desativar√° o registro completamente.

## Exemplo de manifesto {#manifest-example}

O manifesto do site Docusaurus pode servir como inspira√ß√£o:

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## Customizing reload popup {#customizing-reload-popup}

The `@theme/PwaReloadPopup` component is rendered when a new service worker is waiting to be installed, and we suggest a reload to the user. You can [swizzle](../../swizzling.mdx) this component and implement your own UI. It will receive an `onReload` callback as props, which should be called when the `reload` button is clicked. Isso dir√° ao service worker para instalar o service worker em espera e recarregar a p√°gina.

O tema padr√£o inclui uma implementa√ß√£o para o pop-up de recarga e usa [Infima Alerts](https://infima.dev/docs/components/alert).

![A screen recording of the reload process. An alert box shows in the bottom right of the window, saying "New content available". After clicking the "Refresh" button, the page's main heading changes from "Introduction" to "PWA :))".](/img/pwa_reload.gif)

Your component can render `null`, but this is not recommended: users won't have a way to get up-to-date content.
