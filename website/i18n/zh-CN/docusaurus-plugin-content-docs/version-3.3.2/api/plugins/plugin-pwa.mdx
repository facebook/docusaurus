---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus Plugin to add PWA support using [Workbox](https://developers.google.com/web/tools/workbox). This plugin generates a [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers) in production build only, and allows you to create fully PWA-compliant documentation site with offline and installation support.

## Installation {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## Configuration {#configuration}

Create a [PWA manifest](https://web.dev/add-manifest/) at `./static/manifest.json`.

Modify `docusaurus.config.js` with a minimal PWA config, like:

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## Progressive Web App {#progressive-web-app}

å®‰è£… Service Worker è¿˜ä¸è¶³ä»¥è®©ä½ çš„åº”ç”¨æˆä¸ºæ¸è¿›å¼ Web åº”ç”¨ (PWA)ã€‚ You'll need to at least include a [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest) and have the correct tags in `<head>` ([Options > pwaHead](#pwahead)).

After deployment, you can use [Lighthouse](https://developers.google.com/web/tools/lighthouse) to run an audit on your site.

For a more exhaustive list of what it takes for your site to be a PWA, refer to the [PWA Checklist](https://developers.google.com/web/progressive-web-apps/checklist)

## App installation support {#app-installation-support}

å¦‚æœä½ çš„æµè§ˆå™¨æ”¯æŒï¼Œå°±å¯ä»¥æŠŠ Docusaurus å½“ä½œåº”ç”¨å®‰è£…äº†ã€‚

![A screen recording of the installation process. A button appears in the address bar of the browser, which displays a dialog asking "install this application?" when clicked. After clicking the "Install" button, a new application is opened in the operating system, opening to the Docusaurus homepage.](/img/pwa_install.gif)

:::note

å®‰è£…åº”ç”¨éœ€è¦ HTTPS åè®®åŠæœ‰æ•ˆçš„ Manifestã€‚

:::

## Offline mode (precaching) {#offline-mode-precaching}

æˆ‘ä»¬é€šè¿‡ Service Worker é¢„ç¼“å­˜çš„æ–¹å¼æ”¯æŒç”¨æˆ·ç¦»çº¿è®¿é—® Docusaurus ç«™ç‚¹ã€‚

The [workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) page explains the idea:

> Service Worker çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯åœ¨å®‰è£…è¿‡ç¨‹ä¸­æŠŠä¸€äº›æ–‡ä»¶ä¿å­˜åˆ°ç¼“å­˜ã€‚ å› ä¸ºä½ åœ¨ Service Worker å·¥ä½œä¹‹å‰å°±å¼€å§‹ç¼“å­˜å†…å®¹äº†ï¼Œæ‰€ä»¥è¿™ä¸€èˆ¬è¢«ç§°ä¸ºã€Œé¢„ç¼“å­˜ã€ã€‚
>
> ä½¿ç”¨æ­¤åŠŸèƒ½çš„ä¸»è¦åŸå› æ˜¯è®©å¼€å‘è€…æ§åˆ¶ç¼“å­˜ï¼Œå³å†³å®šä½•æ—¶ç¼“å­˜ã€ç¼“å­˜å¤šé•¿æ—¶é—´ã€ä»¥åŠåœ¨ç¦»çº¿æ—¶å‘æµè§ˆå™¨æä¾›å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºç¦»çº¿ç½‘é¡µåº”ç”¨ã€‚
>
> Workbox ä¸ºä½ å®Œæˆäº†é¢„ç¼“å­˜æœŸé—´çš„è¯¸å¤šå¤æ‚å·¥ä½œï¼Œç®€åŒ–äº† API çš„åŒæ—¶è¿˜ç¡®ä¿èƒ½é«˜æ•ˆç‡åœ°ä¸‹è½½èµ„æºã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç½‘ç«™ä½œä¸ºåº”ç”¨ç¨‹åºå®‰è£…æ—¶ï¼Œå°†é»˜è®¤å¯ç”¨ç¦»çº¿æ¨¡å¼ã€‚ See the `offlineModeActivationStrategies` option for details.

ç½‘ç«™é¢„ç¼“å­˜å®Œæ¯•åï¼ŒService Worker å°†ä¸ºä¹‹åçš„è¯·æ±‚æä¾›ç¼“å­˜å¥½çš„å“åº”ã€‚ å½“æ–°æ„å»ºçš„ç‰ˆæœ¬éšç€æ–°çš„ Service Worker ä¸€èµ·éƒ¨ç½²åï¼Œæ–°ç‰ˆæœ¬ä¼šè‡ªåŠ¨å¼€å§‹å®‰è£…å¹¶å˜æˆç­‰å¾…çŠ¶æ€ã€‚ åœ¨æ­¤æœŸé—´ï¼Œç½‘ç«™ä¼šå¼¹å‡ºåˆ·æ–°å¼¹çª—ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ–°å†…å®¹ã€‚ Until the user either clears the application cache or clicks the `reload` button on the popup, the service worker will continue serving the old content.

:::warning

ç¦»çº¿æ¨¡å¼/é¢„ç¼“å­˜éœ€è¦æå‰ä¸‹è½½ç½‘ç«™ä¸Šçš„æ‰€æœ‰é™æ€èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æµé‡æ¶ˆè€—ã€‚ å¹¶éæ¯ä¸ªç«™ç‚¹éƒ½æœ‰å¿…è¦å¼€å¯æ­¤é€‰é¡¹ã€‚

:::

## é€‰é¡¹{#options}

### `debug` {#debug}

- Type: `boolean`
- Default: `false`

æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

- Workbox æ—¥å¿—
- é¢å¤–çš„ Docusaurus æ—¥å¿—
- æœªä¼˜åŒ–çš„ SW æ–‡ä»¶è¾“å‡º
- Source Map

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- Type: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- Default: `['appInstalled', 'queryString', 'standalone']`

å¼€å¯ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥æœ‰ï¼š

- `appInstalled`: activates for users having installed the site as an app (not 100% reliable)
- `standalone`: activates for users running the app as standalone (often the case once a PWA is installed)
- `queryString`: activates if queryString contains `offlineMode=true` (convenient for PWA debugging)
- `mobile`: activates for mobile users (`width <= 996px`)
- `saveData`: activates for users with `navigator.connection.saveData === true`
- `always`: activates for all users

:::warning

ç”¨è¿™ä¸ªåŠŸèƒ½è¦å°å¿ƒï¼šæŸäº›ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢å¼ºåˆ¶ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

It is not possible to detect if a page is rendered as a PWA in a reliable manner.

The `appinstalled` event has been [removed from the specification](https://github.com/w3c/manifest/pull/836), and the [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API is only supported in recent Chrome versions and require `related_applications` declared in the manifest.

The [`standalone` strategy](https://petelepage.com/blog/2019/07/is-my-pwa-installed/) is a nice fallback to activate the offline mode (at least when running the installed app).

:::

### `injectManifestConfig` {#injectmanifestconfig}

[Workbox options](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions) to pass to `workbox.injectManifest()`. è¿™ä¸ªé€‰é¡¹å…è®¸ä½ ç­›é€‰éœ€è¦é¢„ç¼“å­˜ï¼Œä¸”å¯ç¦»çº¿æµè§ˆçš„èµ„æºã€‚

- Type: `InjectManifestOptions`
- Default: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- Type: `({ tagName: string; [attributeName: string]: string })[]`
- Default: `[]`

Array of objects containing `tagName` and key-value pairs for attributes to inject into the `<head>` tag. ç†è®ºä¸Šè¯´ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹æ³¨å…¥ä»»ä½• head æ ‡ç­¾ï¼Œä½†æœ€å¥½æ³¨å…¥é‚£äº›èƒ½è®©ä½ çš„ç½‘ç«™å…¼å®¹ PWA çš„æ ‡ç­¾ã€‚ ä¸‹é¢åˆ—å‡ºäº†èƒ½è®©ä½ çš„åº”ç”¨ç¨‹åºå®Œå…¨å…¼å®¹ PWA çš„æ ‡ç­¾ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- Type: `string | undefined`
- Default: `undefined`

é€‚ç”¨äºé¢å¤–çš„ Workbox è§„åˆ™ã€‚ ä½ å¯ä»¥åœ¨æ­¤å¤„ç¼–å†™ä»»ä½•æƒ³è®© Service Worker åšçš„äº‹ï¼Œè®© Workbox ç‰©å°½å…¶ç”¨ã€‚ ä»£ç ä¼šè¢«è‡ªåŠ¨è½¬è¯‘ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™é‡Œç”¨æœ€æ–°çš„ ES6+ è¯­æ³•ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬è¦ä»å¤–éƒ¨è·¯å¾„ç¼“å­˜æ–‡ä»¶ï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

The module should have a `default` function export, and receives some params.

### `swRegister` {#swregister}

- Type: `string | false`
- Default: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus åº”ç”¨å‰æ·»åŠ å…¥å£ï¼Œåœ¨åº”ç”¨è¿è¡Œå‰è§¦å‘æ³¨å†Œã€‚ The default `registerSW.js` file is enough for simple registration.

Passing `false` will disable registration entirely.

## Manifest example {#manifest-example}

Docusaurus ç½‘ç«™çš„ Manifest å¯ä»¥ç»™ä½ ä¸€äº›å¯å‘ï¼š

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## Customizing reload popup {#customizing-reload-popup}

The `@theme/PwaReloadPopup` component is rendered when a new service worker is waiting to be installed, and we suggest a reload to the user. You can [swizzle](../../swizzling.mdx) this component and implement your own UI. It will receive an `onReload` callback as props, which should be called when the `reload` button is clicked. è¿™ä¼šå‘Šè¯‰ Service Worker å®‰è£…ç­‰å¾…ä¸­çš„æ–°ç‰ˆ Service Workerï¼Œå¹¶åˆ·æ–°é¡µé¢ã€‚

The default theme includes an implementation for the reload popup and uses [Infima Alerts](https://infima.dev/docs/components/alert).

![A screen recording of the reload process. An alert box shows in the bottom right of the window, saying "New content available". After clicking the "Refresh" button, the page's main heading changes from "Introduction" to "PWA :))".](/img/pwa_reload.gif)

Your component can render `null`, but this is not recommended: users won't have a way to get up-to-date content.
